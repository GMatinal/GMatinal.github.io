<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>代码编程规范</title>
    <link rel="icon" href="./../favicon.ico">
    <link rel="stylesheet" href="./../css/base.css">
    <link rel="stylesheet" href="./../css/style.css">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./../font_3876444_fn5q8nnpnei/iconfont.css">
</head>
<body>
    <div class="nav">
        <h1 class="headline">代码编程规范</h1>        
    </div>

    <div class="region">
        <p>1、代码总体原则</p>
        <p>1、清晰第一 </p>
        <p>清晰性是易于维护、易于重构的程序必需具备的特征。代码首先是给人读的，好的代码应当可以像文章一样发声朗诵出来。</p>
        <p>目前软件维护期成本占整个生命周期成本的40%~90%。根据业界经验，维护期变更代码的成本，小型系统是开发期的5倍，大型系统（100万行代码以上）可以达到100倍。业界的调查指出，开发组平均大约一半的人力用于弥补过去的错误，而不是添加新的功能来帮助公司提高竞争力。</p>
        <p>一般情况下，代码的可阅读性高于性能，只有确定性能是瓶颈时，才应该主动优化。</p>
        <p>2、简洁为美</p>
        <p>简洁就是易于理解并且易于实现。代码越长越难以看懂，也就越容易在修改时引入错误。写的代码越多，意味着出错的地方越多，也就意味着代码的可靠性越低。因此，我们提倡大家通过编写简洁明了的代码来提升代码可靠性。</p>
        <p>废弃的代码(没有被调用的函数和全局变量)要及时清除，重复代码应该尽可能提炼成函数。</p>
        <p>3、选择合适的风格，与代码原有风格保持一致</p>
        <p>产品所有人共同分享同一种风格所带来的好处，远远超出为了统一而付出的代价。在公司已有编码规范的指导下，审慎地编排代码以使代码尽可能清晰，是一项非常重要的技能。 如果重构/ / 修改其他风格的代码时，比较明智的做法是根据 现有 代码 的 现有风格继续编写代码，或者使用格式转换工具进行转换成公司内部风格。</p>
        <p>2、头文件</p>
        <p>对于C语言来说，头文件的设计体现了大部分的系统设计。 不合理的头文件布局是编译时间过长的根因，不合理的头文件实际上反映了不合理的设计。</p>
        <p>1、头文件中适合放置接口的声明，不适合放置实现</p>
        <p>头文件是模块（Module）或单元（Unit）的对外接口。头文件中应放置对外部的声明，如对外提供的函数声明、宏定义、类型定义等。</p>
        <p>要求：</p>
        <p>内部使用的函数（相当于类的私有方法）声明不应放在头文件中。</p>
        <p>内部使用的宏、枚举、结构定义不应放入头文件中。</p>
        <p>变量定义不应放在头文件中，应放在.c文件中。</p>
        <p>变量的声明尽量不要放在头文件中，亦即尽量不要使用全局变量作为接口。变量是模块或单元的内部实现细节，不应通过在头文件中声明的方式直接暴露给外部，应通过函数接口的方式进行对外暴露。 即使必须使用全局变量，也只应当在.c中定义全局变量，在.h中仅声明变量为全局的。</p>
        <p>2、头文件应当职责单一，切忌依赖复杂</p>
        <p>头文件过于复杂，依赖过于复杂是导致编译时间过长的主要原因。很多现有代码中头文件过大，职责过多，再加上循环依赖的问题，可能导致为了在.c中使用一个宏，而包含十几个头文件。</p>
        <p>3、头文件应向稳定的方向包含</p>
        <p>头文件的包含关系是一种依赖，一般来说，应当让不稳定的模块依赖稳定的模块，从而当不稳定的模块发生变化时，不会影响（编译）稳定的模块。</p>
        <p>就我们的产品来说，依赖的方向应该是： 产品依赖于平台，平台依赖于标准库。某产品线平台的代码中已经包含了产品的头文件，导致平台无法单独编译、发布和测试，是一个非常糟糕的反例。除了不稳定的模块依赖于稳定的模块外，更好的方式是两个模块共同依赖于接口，这样任何一个模块的内部实现更改都不需要重新编译另外一个模块。在这里，我们假设接口本身是最稳定的。</p>
        <p>4、每一个 .c 文件应有一个同名 .h 文件，用于声明需要对外公开的接口</p>
        <p>如果一个.c文件不需要对外公布任何接口，则其就不应当存在，除非它是程序的入口，如main函数所在的文件。</p>
        <p>现有某些产品中，习惯一个.c文件对应两个头文件，一个用于存放对外公开的接口，一个用于存放内部需要用到的定义、声明等，以控制.c文件的代码行数。编者不提倡这种风格。这种风格的根源在于源文件过大，应首先考虑拆分.c文件，使之不至于太大。另外，一旦把私有定义、声明放到独立的头文件中，就无法从技术上避免别人include之，难以保证这些定义最后真的只是私有的。</p>
        <p>5、禁止头文件循环依赖</p>
        <p>头文件循环依赖，指a.h包含b.h，b.h包含c.h，c.h包含a.h之类导致任何一个头文件修改，都导致所有包含了a.h/b.h/c.h的代码全部重新编译一遍。而如果是单向依赖，如a.h包含b.h，b.h包含c.h，而c.h不包含任何头文件，则修改a.h不会导致包含了b.h/c.h的源代码重新编译。</p>
        <p>很多系统中头文件包含关系复杂，开发人员为了省事起见，可能不会去一一钻研，直接包含一切想到的头文件，甚至有些产品干脆发布了一个god.h，其中包含了所有头文件，然后发布给各个项目组使用，这种只图一时省事的做法，导致整个系统的编译时间进一步恶化，并对后来人的维护造成了巨大的麻烦。</p>
        <p>7、头文件应当自包含 </p>
        <p>简单的说，自包含就是任意一个头文件均可独立编译。如果一个文件包含某个头文件，还要包含另外一个头文件才能工作的话，就会增加交流障碍，给这个头文件的用户增添不必要的负担。</p>
        <p>示例：如果a.h不是自包含的，需要包含b.h才能编译，会带来的危害：每个使用a.h头文件的.c文件，为了让引入的a.h的内容编译通过，都要包含额外的头文件b.h。额外的头文件b.h必须在a.h之前进行包含，这在包含顺序上产生了依赖。</p>
        <p>注意：该规则需要与“.c/.h文件禁止包含用不到的头文件”规则一起使用，不能为了让a.h自包含，而在a.h中包含不必要的头文件。a.h要刚刚可以自包含，不能在a.h中多包含任何满足自包含之外的其他头文件。</p>
        <p>8、总是编写内部 #include 保护符（ #define  保护）</p>
        <p>多次包含一个头文件可以通过认真的设计来避免。如果不能做到这一点，就需要采取阻止头文件内容被包含多于一次的机制。通常的手段是为每个文件配置一个宏，当头文件第一次被包含时就定义这个宏，并在头文件被再次包含时使用它以排除文件内容。所有头文件都应当使用#define 防止头文件被多重包含，命名格式为FILENAME_H，为了保证唯一性，更好的命名是PROJECTNAME_PATH_FILENAME_H。</p>
        <p>9、禁止在头文件中定义变量</p>
        <p>在头文件中定义变量，将会由于头文件被其他.c文件包含而导致变量重复定义。</p>
        <p>10、只能通过包含头文件的方式使用其他 .c 提供的接口，禁止在.c 中通过 extern 的方式使用外部函数接口、变量</p>
        <p>若a.c使用了b.c定义的foo()函数，则应当在b.h中声明extern int foo(int input)；并在a.c中通过#include <b.h>来使用foo。禁止通过在a.c中直接写extern int foo(int input);来使用foo，后面这种写法容易在foo改变时可能导致声明和定义不一致。</p>
        <p>未完待续......</p>
    </div>



    <a href="./../smalltalk.html"class="back-top-btn">
        <span class="iconfont">&#xe6ff;</span>
    </a>

</body>
</html>